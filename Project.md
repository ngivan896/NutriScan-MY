# NutriScan MY - 马来西亚食物智能识别系统

## 项目背景

这是一个为期 **8 周**的学术项目，目标是构建一个基于深度学习的移动端应用，专门识别马来西亚本地食物并提供即时营养分析。

**核心价值**：
- 填补马来西亚本地食物 AI 识别的技术空白
- 为公共健康和营养管理提供数字化工具
- 数字化保存和传播本地饮食文化

**目标用户**：
- 🌍 **外国游客** - 快速了解马来西亚美食及营养信息
- 👥 **本地多元种族居民** - 跨文化饮食理解
- 🏥 **健康管理人群** - 饮食营养追踪
- 📚 **文化学习者** - 了解马来西亚饮食文化

---

## 技术架构

### 整体技术栈

```
Frontend:  React Native + Expo
UI/UX:     React Native Reanimated + Skia (流畅动画)
Design:    Tailwind/NativeWind (快速样式) + 自定义组件库
i18n:      react-i18next (多语言国际化)
AI Model:  YOLOv8 (Ultralytics) → TensorFlow Lite
Training:  Google Colab (Free Tier)
Backend:   Firebase (Free Plan)
LLM API:   Gemini API (Primary) / DeepSeek (Backup)
Data:      Roboflow (Dataset Management)
```

### 系统工作流程（使用 Gemini Vision）

1. **用户拍照** → 移动端相机采集图像
2. **本地推理** → TFLite 模型识别食物类别（返回 food_id，如 "nasi_lemak"）
3. **查询缓存** → 检查本地是否有该图像的营养数据（基于图像哈希）
4. **Gemini Vision 分析** → 如缓存未命中，发送图像 + 菜品名称到 Gemini Vision API
   - 🔍 **视觉识别**：分析图像中实际包含的食材（准确识别变体）
   - 🧮 **营养计算**：基于实际食材估算营养成分
   - ⚠️  **过敏原检测**：仅列出图像中可见的过敏原
   - 📊 **份量估计**：评估食物份量（小/中/大份）
5. **本地缓存** → 保存 Vision API 响应到本地（图像哈希 + 7天有效期）
6. **结果展示** → 可视化呈现实际食材、热量、过敏原、文化背景

**核心优势**：
- ✅ **准确性**：基于图像实际内容，而非标准配置
- ✅ **灵活性**：自动处理各种食物变体（有/无特定配料）
- ✅ **个性化**：每份食物的营养分析都是定制的

**设计理念**：无硬编码营养数据，完全动态化 + 视觉智能 + 智能缓存

---

## 性能指标

| 指标 | 目标值 | 备注 |
|------|--------|------|
| **识别准确率** | mAP50 > 80% | 核心学术指标 |
| **推理速度** | < 100ms | 移动端实时体验 |
| **模型大小** | < 20MB | TFLite 格式 |
| **食物类别** | 20 种 | 马来西亚代表性食物 |
| **训练时长** | 2-4 小时 | Colab T4 GPU，100 epochs |

---

## 数据集设计

### 食物类别（20种）
马来西亚代表性食物完整列表：

| # | 英文名称 | 中文名称 | 分类 |
|---|---------|---------|------|
| 1 | Nasi Lemak | 椰浆饭 | 主食 |
| 2 | Bak Kut Teh | 肉骨茶 | 汤品 |
| 3 | Rojak | 罗惹 | 沙拉/小吃 |
| 4 | Nasi Kerabu | 蓝花饭 | 主食 |
| 5 | Char Kway Teow | 炒粿条 | 面食 |
| 6 | Hokkien Mee | 福建面 | 面食 |
| 7 | Cendol | 煎蕊 | 甜品 |
| 8 | Roti Canai | 印度煎饼 | 主食 |
| 9 | Chicken Rice | 海南鸡饭 | 主食 |
| 10 | Ramly Burger | Ramly汉堡 | 快餐 |
| 11 | Curry Laksa | 咖喱叻沙 | 面食/汤品 |
| 12 | Satay | 沙爹 | 烧烤/小吃 |
| 13 | Wantan Mee | 云吞面 | 面食 |
| 14 | Nasi Kandar | 嘛嘛档饭 | 主食 |
| 15 | Kolo Mee | 干捞面 | 面食 |
| 16 | Chili Pan Mee | 辣椒板面 | 面食 |
| 17 | Chee Cheong Fun | 猪肠粉 | 点心 |
| 18 | Claypot Chicken Rice | 砂煲鸡饭 | 主食 |
| 19 | Apam Balik | 曼煎糕 | 甜品/小吃 |
| 20 | Lemang | 竹筒糯米饭 | 主食 |

**类别分布**：
- 主食类：7种（Nasi Lemak, Nasi Kerabu, Roti Canai, Chicken Rice, Nasi Kandar, Claypot Chicken Rice, Lemang）
- 面食类：6种（Char Kway Teow, Hokkien Mee, Curry Laksa, Wantan Mee, Kolo Mee, Chili Pan Mee）
- 甜品/小吃：4种（Cendol, Rojak, Satay, Apam Balik）
- 其他：3种（Bak Kut Teh, Ramly Burger, Chee Cheong Fun）

### 数据采集规格
- **总图像数**：1000+ 张
- **每类图像**：50 张高质量标注图像
- **数据来源**：自行拍摄 + 公开数据集补充
- **标注工具**：Roboflow（边界框标注）
- **数据增强**：Roboflow 自动增强

### 数据文件说明

**food_categories.json** - 模型训练配置文件
- ✅ **包含**：food_id, 食物名称（三语）, 类别, 关键词, 视觉特征
- ❌ **不包含**：营养数据、过敏原、文化描述（由 LLM 动态生成）
- 用途：YOLOv8 训练标签映射、模型推理结果解析

**llm_integration_guide.md** - LLM 动态分析指南
- 完整的 Prompt 设计模板
- API 调用实现代码
- 缓存策略和性能优化
- 离线回退方案

**学术贡献点**：创建首个公开的马来西亚食物标注数据集

---

## 开发计划

### MVP 功能优先级

#### P0 - 必须完成（核心功能）
- [ ] 20 种食物识别功能
- [ ] 基本营养信息展示（热量、蛋白质、碳水、脂肪）
- [ ] 相机拍照和图库选择
- [ ] **多语言支持**（英语、中文简体、马来语）- 服务外国游客和多元种族
- [ ] **现代化 UI 设计**（动画过渡、视觉反馈、响应式布局）
- [ ] **精美的结果展示页**（图表可视化、渐进式信息展示）

#### P1 - 应该完成（重要功能）
- [ ] 过敏原检测和警告（多语言）
- [ ] 核心食材成分列表
- [ ] 食物文化背景介绍（帮助外国游客了解）
- [ ] 历史记录保存
- [ ] **深色模式支持**
- [ ] **微交互动效**（按钮反馈、加载动画）

#### P2 - 可以延期（增强功能）
- [ ] 个性化健康建议
- [ ] 更多语言支持（淡米尔语、日语、韩语）
- [ ] 社交分享功能
- [ ] 离线模式（下载营养数据库）

### 移动端核心模块

```
📱 App Structure
├── Image_Capture_Module    # 相机接口 + 图像预处理
├── Model_Inference_Module  # TFLite 本地推理引擎（识别食物ID）
├── LLM_Integration_Module  # 动态营养分析 API
│   ├── Prompt Generator    # 生成多语言Prompt
│   ├── API Client          # Gemini/DeepSeek API调用
│   ├── Cache Manager       # 本地缓存管理（AsyncStorage）
│   └── Fallback Handler    # 离线数据回退
├── i18n_Module            # 多语言国际化管理
└── UI_Display_Module       # 结果可视化展示
```

---

## LLM 集成策略（Gemini Vision）

### 核心设计理念

**无硬编码架构 + 视觉智能** - 所有营养信息、过敏原、文化描述由 Gemini Vision API 基于图像实时生成

**技术选择**：
- 🎯 **主要**：Google Gemini 1.5 Pro Vision（免费额度：60次/分钟）
- 🔄 **备用**：GPT-4 Vision / Qwen-VL（按需启用）

**核心优势**：
- ✅ **视觉准确性**：基于图像实际内容分析，而非标准配置
- ✅ **变体识别**：自动处理食物变体（如 Nasi Lemak 有炸鸡/炸鱼/素食版本）
- ✅ **无硬编码**：无需维护静态营养数据库
- ✅ **知识更新**：LLM 知识自动更新（食物配方变化、最新研究）
- ✅ **多语言**：原生支持中英马来文三语
- ✅ 智能化调整（可根据份量、烹饪方式动态计算）
- ✅ 多语言原生支持（一次调用返回目标语言）
- ✅ 文化描述更丰富和个性化

**缓存机制** - 基于图像哈希的智能缓存：
- **缓存键**：图像哈希（MD5/SHA256）+ food_id
- **原因**：同一道菜的不同版本需要不同分析（如有/无炸鸡）
- Layer 1: 内存缓存（当前会话，按图像哈希）
- Layer 2: AsyncStorage（7天有效期，图像哈希 → 分析结果）
- Layer 3: Gemini Vision API 调用（发送图像 + 菜品名称）
- Layer 4: 离线回退数据（基本营养信息）

### API 选择方案

**主方案：Gemini API**
- 免费额度：15 RPM，月 64,800 次请求
- 响应速度快（~500ms）
- 营养分析能力强
- 支持多语言原生输出

**备用方案：DeepSeek API**
- 成本更低（$0.14/M tokens）
- 中文理解能力优秀
- 响应质量稳定

**本地方案：Ollama (llama3.2 1B)**
- 完全离线运行
- 用于网络不可用时的回退
- 精度略低但保证可用性

### Gemini Vision Prompt 设计模式

```python
# Gemini Vision 营养分析 Prompt 模板（基于图像）
"""
这张图像显示的是马来西亚食物：{food_name}

请仔细观察图像内容，提供以下信息：

1. **实际包含的食材**（仅基于图像中实际看到的）：
   - 中文、英文、马来文三语列表
   - 不要使用标准配置，只列出图像中可见的食材
   - 如有替代食材（如鱼代替鸡），请准确说明

2. **营养成分估算**（基于实际看到的食材和份量）：
   - 卡路里（kcal）
   - 蛋白质（g）
   - 脂肪（g）
   - 碳水化合物（g）

3. **过敏原警告**（仅基于图像中看到的食材）：
   - 花生、海鲜、鸡蛋、乳制品、麸质等

4. **份量评估**：
   - 小份/中份/大份
   - 估算重量（克）

5. **文化背景**（1-2句话）：
   - 简要介绍此食物的文化意义

请以 JSON 格式返回，包含中英马来三语信息。

Output Format:
{
  "food_name": {"en": "Nasi Lemak", "zh": "椰浆饭", "ms": "Nasi Lemak"},
  "actual_components": [
    {"en": "Coconut Rice", "zh": "椰浆饭", "ms": "Nasi Lemak"},
    {"en": "Fried Fish", "zh": "炸鱼", "ms": "Ikan Goreng"}
  ],
  "nutrition": {
    "calories": 650,
    "protein": 25,
    "fat": 35,
    "carbs": 60
  },
  "allergens": ["peanuts", "fish", "eggs"],
  "portion_size": {"size": "medium", "weight_g": 450},
  "cultural_info": {
    "en": "Malaysia's national dish...",
    "zh": "马来西亚国民早餐...",
    "ms": "Makanan kebangsaan Malaysia..."
  }
}
"""
```

**关键优势**：
- 🔍 基于图像实际内容，而非标准食谱
- 📊 自动处理份量差异和食物变体
- 🌐 一次调用获得三语信息
- ✅ 准确识别替代食材（如炸鱼 vs 炸鸡）

### 语言策略

| 语言 | 代码 | 用户群 | 优先级 |
|------|------|---------|--------|
| **English** | en | 外国游客、国际用户 | P0 |
| **中文简体** | zh | 华人社群、中国游客 | P0 |
| **Bahasa Malaysia** | ms | 本地马来人 | P0 |
| Tamil | ta | 印度裔社群 | P2 |
| Japanese | ja | 日本游客 | P2 |
| Korean | ko | 韩国游客 | P2 |

---

## 风险管理

### 技术风险

| 风险 | 应对措施 |
|------|----------|
| **模型训练失败** | 使用预训练 YOLOv8 模型微调 |
| **LLM API 超限** | 实现本地缓存 + 离线数据库 |
| **移动端性能差** | 量化优化 TFLite 模型 |
| **时间不足** | 每周进度审查，动态调整优先级 |

### 资源风险

- **计算资源**：Google Colab 免费 GPU（每日限额）
- **存储空间**：Google Drive 15GB 免费空间
- **API 调用**：Gemini 免费额度监控

---

## 学术价值

### 技术创新点

1. **数据集贡献**  
   首个针对马来西亚本地食物的开源标注数据集

2. **轻量化优化**  
   在移动端实现实时高精度食物识别（< 20MB）

3. **端到端系统**  
   展示从数据收集、模型训练到 App 部署的完整流程

### 研究意义

- **公共卫生**：支持糖尿病、肥胖等慢性病的饮食管理
- **文化保护**：数字化记录传统食物的营养特征
- **技术推广**：为资源有限环境下的 AI 应用提供参考

---

## 最终交付物

### 代码库
- ✅ Google Colab 训练笔记本（含完整注释）
- ✅ React Native App 源码
  - ✅ LLM 动态营养分析模块
  - ✅ 多语言国际化支持（en/zh/ms）
  - ✅ 智能缓存系统
  - ✅ 离线回退方案
- ✅ TFLite 模型文件（YOLOv8 优化版）

### 数据集
- ✅ 1000+ 标注图像（Roboflow 格式）
- ✅ 数据集说明文档和使用协议

### 文档
- ✅ 技术报告（方法论 + 实验结果）
- ✅ 性能测试报告（mAP、速度、混淆矩阵）
- ✅ 用户使用指南和 API 文档

### 演示
- ✅ 实机运行视频（展示流畅的 UI 动画和交互）
- ✅ 20 种食物识别准确率展示
- ✅ UI/UX 设计展示（界面截图、交互流程图）

---

## 开发时间线（8周）

```
Week 1-2:  数据收集和标注（Roboflow）+ UI 设计原型
Week 3-4:  YOLOv8 模型训练和优化（Colab）+ UI 组件库搭建
Week 5-6:  React Native App 开发（核心功能 + 精美界面实现）
Week 7:    LLM 集成和测试 + UI 动画和交互优化
Week 8:    性能优化、UI 细节打磨、文档撰写、最终演示准备
```

---

## 成功标准

✅ **技术指标达标**：mAP50 > 80%，推理 < 100ms  
✅ **功能完整性**：P0 + P1 功能全部实现  
✅ **多语言质量**：英语/中文/马来语 100% 覆盖，翻译准确专业  
✅ **UI/UX 质量**：现代化设计，流畅动画（60 FPS），跨文化友好  
✅ **学术贡献**：数据集开源 + 技术文档完善  
✅ **可演示性**：实机运行流畅，识别准确，界面美观，适合国际展示  

---

## 项目定位

这是一个 **面向国际游客和多元社会的学术原型系统**，注重用户体验和文化包容性。

**核心定位**：
- 🌏 **国际化优先** - 专为外国游客和多元种族设计
- 🎨 **完美的 UI** - 现代、美观、符合人体工程学
- 🔬 **技术创新** - 高精度识别 + 流畅交互体验
- 📚 **文化传播** - 展示马来西亚饮食文化

**核心追求**：
- ✅ **三语支持** - English/中文/Bahasa Malaysia
- ✅ **跨文化设计** - 符合不同文化背景用户习惯
- ✅ **旅游友好** - 快速识别、简单操作、实用信息
- ✅ **学术价值** - 技术可行性验证 + 方法学贡献

**适度简化**：大规模部署优化、商业化功能

---

*最后更新：2025-10-03*
